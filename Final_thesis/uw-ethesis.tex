\documentclass[letterpaper,12pt,titlepage,oneside,final]{book}

% For PDF, suitable for double-sided printing, change the PrintVersion variable below
% to "true" and use this \documentclass line instead of the one above:
%\documentclass[letterpaper,12pt,titlepage,openright,twoside,final]{book}

% Some LaTeX commands I define for my own nomenclature.
% If you have to, it's better to change nomenclature once here than in a 
% million places throughout your thesis!
\newcommand{\package}[1]{\textbf{#1}} % package names in bold text
\newcommand{\cmmd}[1]{\textbackslash\texttt{#1}} % command name in tt font 
\newcommand{\href}[1]{#1} % does nothing, but defines the command so the
% print-optimized version will ignore \href tags (redefined by hyperref pkg).
%\newcommand{\texorpdfstring}[2]{#1} % does nothing, but defines the command
% Anything defined here may be redefined by packages added below...

% This package allows if-then-else control structures.
\usepackage{ifthen}
\newboolean{PrintVersion}
\setboolean{PrintVersion}{false} 
% CHANGE THIS VALUE TO "true" as necessary, to improve printed results for hard copies
% by overriding some options of the hyperref package below.

%\usepackage{nomencl} % For a nomenclature (optional; available from ctan.org)
\usepackage{amsmath,amssymb,amstext} % Lots of math symbols and environments
\usepackage[pdftex]{graphicx} % For including graphics N.B. pdftex graphics driver 
\usepackage[acronym,automake]{glossaries}
\usepackage{siunitx}
\usepackage{multirow}
\usepackage{setspace}
\usepackage[paper=a4paper,margin=1in]{geometry}
\usepackage{tikz}

%here declear the acronym
\newacronym{who}{WHO}{World Health Organization}
\newacronym{ncoa}{NCOA}{the National Council of Aging}
\newacronym{mems}{MEMS}{Micro-Electro-Mechanical}
\newacronym{imu}{IMU}{Inertia Measurement Unit}
\newacronym{adc}{ADC}{analog-to-digital}
\newacronym{lsb}{LSB}{Least Significant Bit}
\newacronym{ssf}{SSF}{Sensitivity Scale Factor}
\newacronym{mcu}{MCU}{Micro-Controller Unit}
\newacronym{iot}{IoT}{Internet-of-Things}
\newacronym{us}{U.S.}{United State of America}


\makeglossaries
% Hyperlinks make it very easy to navigate an electronic document.
% In addition, this is where you should specify the thesis title
% and author as they appear in the properties of the PDF document.
% Use the "hyperref" package 
% N.B. HYPERREF MUST BE THE LAST PACKAGE LOADED; ADD ADDITIONAL PKGS ABOVE
\usepackage[pdftex,letterpaper=true,pagebackref=false]{hyperref} % with basic options
% N.B. pagebackref=true provides links back from the References to the body text. This can cause trouble for printing.
\hypersetup{
	plainpages=false,       % needed if Roman numbers in frontpages
	pdfpagelabels=true,     % adds page number as label in Acrobat's page count
	bookmarks=true,         % show bookmarks bar?
	unicode=false,          % non-Latin characters in Acrobat’s bookmarks
	pdftoolbar=true,        % show Acrobat’s toolbar?
	pdfmenubar=true,        % show Acrobat’s menu?
	pdffitwindow=false,     % window fit to page when opened
	pdfstartview={FitH},    % fits the width of the page to the window
	pdftitle={uWaterloo\ LaTeX\ Thesis\ Template},    % title: CHANGE THIS TEXT!
	%    pdfauthor={Author},    % author: CHANGE THIS TEXT! and uncomment this line
	%    pdfsubject={Subject},  % subject: CHANGE THIS TEXT! and uncomment this line
	%    pdfkeywords={keyword1} {key2} {key3}, % list of keywords, and uncomment this line if desired
	pdfnewwindow=true,      % links in new window
	colorlinks=true,        % false: boxed links; true: colored links
	linkcolor=black,         % color of internal links
	citecolor=black,        % color of links to bibliography
	filecolor=magenta,      % color of file links
	urlcolor=cyan           % color of external links
}
\ifthenelse{\boolean{PrintVersion}}{   % for improved print quality, change some hyperref options
	\hypersetup{	% override some previously defined hyperref options
		%    colorlinks,%
		citecolor=black,%
		filecolor=black,%
		linkcolor=black,%
		urlcolor=black}
}{} % end of ifthenelse (no else)

% Setting up the page margins...
% uWaterloo thesis requirements specify a minimum of 1 inch (72pt) margin at the
% top, bottom, and outside page edges and a 1.125 in. (81pt) gutter
% margin (on binding side). While this is not an issue for electronic
% viewing, a PDF may be printed, and so we have the same page layout for
% both printed and electronic versions, we leave the gutter margin in.
% Set margins to minimum permitted by uWaterloo thesis regulations:
\setlength{\marginparwidth}{0pt} % width of margin notes
% N.B. If margin notes are used, you must adjust \textwidth, \marginparwidth
% and \marginparsep so that the space left between the margin notes and page
% edge is less than 15 mm (0.6 in.)
\setlength{\marginparsep}{0pt} % width of space between body text and margin notes
\setlength{\evensidemargin}{0.125in} % Adds 1/8 in. to binding side of all 
% even-numbered pages when the "twoside" printing option is selected
\setlength{\oddsidemargin}{0.125in} % Adds 1/8 in. to the left of all pages
% when "oneside" printing is selected, and to the left of all odd-numbered
% pages when "twoside" printing is selected
\setlength{\textwidth}{6.375in} % assuming US letter paper (8.5 in. x 11 in.) and 
% side margins as above
\raggedbottom
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}
% The following statement specifies the amount of space between
% paragraphs. Other reasonable specifications are \bigskipamount and \smallskipamount.
\setlength{\parskip}{\medskipamount}

% The following statement controls the line spacing.  The default
% spacing corresponds to good typographic conventions and only slight
% changes (e.g., perhaps "1.2"), if any, should be made.
\renewcommand{\baselinestretch}{1} % this is the default line space setting

% By default, each chapter will start on a recto (right-hand side)
% page.  We also force each section of the front pages to start on 
% a recto page by inserting \cleardoublepage commands.
% In many cases, this will require that the verso page be
% blank and, while it should be counted, a page number should not be
% printed.  The following statements ensure a page number is not
% printed on an otherwise blank verso page.
\let\origdoublepage\cleardoublepage
\newcommand{\clearemptydoublepage}{%
	\clearpage{\pagestyle{empty}\origdoublepage}}
\let\cleardoublepage\clearemptydoublepage
%======================================================================5
%   L O G I C A L    D O C U M E N T -- the content of your thesis
%======================================================================
\begin{document}
%delete chapter 
\makeatletter
\def\@makechapterhead#1{%
	{\parindent \z@ \raggedright \normalfont
		\ifnum \c@secnumdepth >\m@ne
		\huge\bfseries \thechapter.\ % <-- Chapter # (without "Chapter")
		\fi
		\interlinepenalty\@M
		#1\par\nobreak% <------------------ Chapter title
		\vskip 10\p@% <------------------ Space between chapter title and first paragraph
}}
% For a large document, it is a good idea to divide your thesis
% into several files, each one containing one chapter.
% To illustrate this idea, the "front pages" (i.e., title page,
% declaration, borrowers' page, abstract, acknowledgements,
% dedication,   of contents, list of tables, list of figures,
% nomenclature) are contained within the file "uw-ethesis-frontpgs.tex" which is
% included into the document by the following statement.
%----------------------------------------------------------------------
% FRONT MATERIAL
%----------------------------------------------------------------------
\input{uw-ethesis-frontpgs} 
\printglossaries
\setstretch{1.5}
%----------------------------------------------------------------------
% MAIN BODY
%----------------------------------------------------------------------
% Because this is a short document, and to reduce the number of files
% needed for this template, the chapters are not separate
% documents as suggested above, but you get the idea. If they were
% separate documents, they would each start with the \chapter command, i.e, 
% do not contain \documentclass or \begin{document} and \end{document} commands.
%======================================================================
\chapter{Introduction}
%======================================================================

%----------------------------------------------------------------------
\section{Introduction to Fall}
%---------------------------------------------------------------------
Nowadays, fall is becoming a dangerous issue which mostly cause the injuries and even leads to disability or fatal death on human, especially the elderly. According to Hwang \textit{et.at.} \cite{static1}, in the United State, one-third to one-half of elderly people over 65 years old fall at least one time each year  and two-third of them will do so again within the next 6 months. Every 11 seconds, there is an elderly person is treated in the hospital's emergency area due to fall-related injuries and every 19 minutes, one faller die \cite{ncoa}. It is also reported that one out every 200 falls results in a hip fracture on people with age among 65 and 69 and increase to one out of 10 for those aged 85 and more \cite{hip_fracture}. The most profound effect of falling is the loss of functioning associated with the dependency of the elderly for the rest of their life. Besides, a great amount time and money have been spent on the medical treatments for the falls. Approximately \$179 million were used as direct medical costs for treating fatal falls and \$19 billion for non-fatal fall injuries within 2000 \cite{cost_fatal}.

\section{Definition of a Fall}
Before starting a research about falls, it is necessary to understand about the meaning of the term \textit{falls}. According to \gls{who}, a fall is defined as an event which results in a person coming to rest inadvertently on the ground or floor or other lower level with or without loss of consciousness or injury \cite{who}. 

\section{Cause of a Fall}
In recent years, a lot of researches have been done by different groups to find out the causes of falls. There have been different ways to classify the causes of a fall such as age and sex, drugs, cognitive functions, postural control, etc. However, because falling is an unintentional action, many causes usually combine to produce a fall. Therefore, these causes can be divided into two main categories, intrinsic and extrinsic, to ease the complication of research activities.
\subsection{Intrinsic risk factors}
Intrinsic factors are the factors which are within the body. It is also the physical aspect of the body that can cause injuries. Intrinsic factors include physical diseases such as cognitive impairment, postural hypotension, cardiovascular problems, etc.\par
\vspace{0.3cm}
\textbf{\textit{Cognitive Impairment}}\par
It is well recognized that cognitive impairment is the common cause of fall on human, especially the elderly. Due to the research of Prudheim \textit{et al.} in 1981, fallers have in general been found to have a higher prevalence of cognitive impairment than non-fallers \cite{cognitive_1}. It is also reported that human with dementia are approximately 3 times more likely to fall than non-demented \cite{cognitive_2}. The reason why patients with cognitive impairment are likely to fall is that they have increased reaction time, increased postural sway and increased leaning balance which result in the decrease on muscle strength, worse balance and poorer mobility. \par
\vspace{0.3cm}
\textbf{\textit{Postural Control}}\par
Postural control is a complex motor skill that requires interaction of multiple body systems which results in the ability to maintain postural orientation or postural stability \cite{postural_1}\cite{postural_2}. The impairment of postural control is indicated as one of significant causes of the fall during any activities at any age. Impaired control of gait and balance are two main aspects of the postural control that have been considered in many studies about falls. Subjectively assessed gait has been reported to be abnormal in many fall activities and other studies using more objective measurements have found some relations between the impaired gait and balance and risk of falling \cite{bibli_book}.

\vspace{0.3cm}
\textbf{\textit{Cardiovascular problem}}\par
Cardiovascular disorders are responsible for approximately 77\% of patients with unexplained or recurrent falls and falls associated with unexplained loss of consciousness \cite{cardio_1}. There is a fact that fallers with cardiovascular disorders have a greater mortality than those with non-cardiovascular or unknown causes \cite{cardio_2}.   
\subsection{Extrinsic risk factors}
Extrinsic factors are those related to the environment such as lighting, walking surface, loose carpets, and high or narrow steps. 

\vspace{0.3cm}
\textbf{\textit{Dim lighting or glare}}\par
Dim lighting is one significant cause of fall on human, especially on the elderly. While walking on the low light condition, the patient's visibility is reduced which prevents them from detecting the obstacles on the walking path and causing stumble and fall. Too bright lighting can also cause fall on human because of creating glares and distorting the way object look. \par
\vspace{0.3cm}
\textbf{\textit{Bad staircase design}}\par

Bad staircase design is also another extrinsic risk that cause the fall on human. Too high or too low rise of staircases have caused a number of falls because people fail to perceive the abnormal elevation change or incur a misstep on descent. Besides, slippery surface of the treads can cause strip on patients while walking up or down the stairs. One more mistake of staircase design that can lead to the fall is lighting on the stair. Poor visibility and inadequate lighting can cause a user to misread the stair edge, resulting in faulty foot placement and falls.
\section{Consequence of Falls}
The consequences of falls are serious to human at any age in any circumstance, but to the elderly they have significance beyond that in younger people. There are different consequences related to the falls on human including physical effects, psychological effects and other consequences such as dependency, hospital admission or economic consequences. 

\vspace{0.3cm}
\textbf{\textit{Physical consequences}}\par

Physical consequences of falls are always a significant aspect that many scientists have focused on in recent years. According to the \gls{ncoa} of the U.S., falls are the leading cause of fatal injuries and the most common cause of non-fatal traumas \cite{ncoa}. There are several physical injuries such as bruise, fracture or head injury reported to happen with patients who suffer from falls. In such injuries, hip fractures and head traumas are two common problems which usually analyzed by researchers. \par
Hip fractures cause the greatest health problems and greatest number of death. It is reported that a quarter million hip fractures occur each year among people older than 50 years in the U.S. but more common in woman than men and increase in frequency with increasing age \cite{bibli_book} \cite{medicinenet_fracture}. Most patients with the hip fractures after falls are hospitalized, but about half of all seniors cannot return home or live independently after that. In 1986, it costs for more than \$3 billions for direct medical treatment of hip fractures.\par 
Head injuries are also usually happen to patients after suffering a fall. It is reported that people with the age of over 65 years old make up for 10-15\% of admission to the hospital because of head injuries while three-quarters of them are caused by fall.  \par

Finally, the most serious impacts of fall is fatal injuries causing death to patient. According to data from the \gls{who}, the fall morality rate of people with the age of over 65 in the \gls{us} (in 2003) was 36.8 per 100 000 citizens \cite{death_in_USA}. The main reason of these accidental death is that many patients have lie on the ground for several hours before receiving the help from caregivers. \par

\vspace{0.3cm}
\textbf{\textit{Psychological consequences}}\par
Fall can result in long lasting psychological impact, called fear of falling again, more than just a short term injury. For those people who have fallen one time before seem to have a feeling of vulnerability which limits them from their normal activities. They may be worried about falling and hurting themselves again, thus stop going out on their own or reduce their level of physical activities. Unfortunately, in attempting to reduce their risk of falling,  they may increase risk of falling because of the attenuation of physical functions. 	

\vspace{0.3cm}
\textbf{\textit{Other consequences}}\par
Some research indicated that there are other consequences such as dependency, hospital admission or economic consequence. As already mentioned, the fear of falling again prevent patients from living alone and start depending on the long-term nursing care. This consequence directly leads to increased dependency, which require more time and financial resources from both government and family. \par
Falls are also the main reason for fallers to be admitted to hospital as an emergency case. Due to the information provided by Accident Department at a sample of hospitals in England and Wales, in 1998, approximately 200 000 people over 60 are treated at this hospital per year because of a fall at home \cite{other_consequence_1}.\par
Finally, falls are also a burden for economical aspect of every countries around the world, especially for low and lower middle countries. According to the U.S. Center for Disease Control and Prevention, in 2015, there was \$50 billion being used for fall injuries and expected to increase as the population ages and may reach \$67.7 billion by 2020 \cite{ncoa}.
\section{Challenge in Detecting Falls and Motivation for This Thesis}

\section{Objectives}

\section{Overview of Thesis Works}

\section{Thesis Organization}

%======================================================================
\chapter{Literature Review}

\section{Existing Commercial Devices}

\section{Existing Products from Other Research Groups}


\chapter{Statement of Problem and Methodology}

\section{Problem}

\section{Methodology}

\subsection{Position of sensor}

\subsection{Fall detection algorithm}

\section{Algorithm}

\chapter{Sytem overview}

\section{System Components}

\subsection{Hardware Components}

\subsubsection{Sensor}

\subsubsection{Microcontroller}

\subsubsection{Wireless Module}

\subsection{Software}

\subsubsection{Embeddded Software on Sensor Node}

\subsubsection{Communication System}

\subsubsection{Data Acquisition Software}

\subsubsection{Data Analysis Software}

\subsection{System Intergration}

\chapter{Experimental and Procedure}

\section{Data Collection}

\section{Data Analysis}

\section{Experiment on Real Subjects to Evaluate the Performance of The Network}

\chapter{Results and Discussion}

\section{Results Assessment}

\section{Comparing the performance with existing works}

\chapter{Conclusion and Future Works}

\section{Summary}

\section{Limitations}

\section{Future works}
%======================================================================


\appendix
% Add a title page before the appendices and a line in the Table of Contents
\addcontentsline{toc}{chapter}{APPENDICES}
%======================================================================
\chapter{C/C++ Code for Reading Data from Sensor}
\begin{verbatim}
#include "Arduino.h"
#include "MPU6050.h"
#include "Wire.h"
#include "WiFiClient.h"
#include "ESP8266WiFiMulti.h"

ESP8266WiFiMulti WiFiMulti ;
#if I2CDEV_IMPLEMENTATION == I2CDEV_ARDUINO_WIRE
#include "Wire.h"
#endif

MPU6050 accelgyro;
//MPU6050 accelgyro(0x69); // <-- use for AD0 high

int16_t ax, ay, az;
int16_t gx, gy, gz;
float rotX, rotY, rotZ,normAcc;
float gyroX, gyroY, gyroZ, normGyro;
#define OUTPUT_READABLE_ACCELGYRO

#define LED_PIN 2
bool blinkState = false;

void Print_IMU()
{
#ifdef SERIAL_DEBUG
	Serial.println("Accelerometer:");
	Serial.print(rotX);
	Serial.print("\t");
	Serial.print(rotY);
	Serial.print("\t");
	Serial.println(rotZ);
	Serial.println("Gyroscope: ");
	Serial.print(gyroX);
	Serial.print("\t");
	Serial.print(gyroY);
	Serial.print("\t");
	Serial.println(gyroZ);
	#endif
	Serial.print(normAcc);
	Serial.print(" ");
	Serial.println(normGyro);
}

void init_IMU() {
	// join I2C bus (I2Cdev library doesn't do this automatically)
	Wire.begin();
	Serial.begin(115200);
	
	// initialize device
	Serial.println("Initializing I2C devices...");
	accelgyro.initialize();
	
	// verify connection
	Serial.println("Testing device connections...");
	Serial.println(accelgyro.testConnection() ? "MPU6050 connection successful" 
	: "MPU6050 connection failed");
	
	// use the code below to change accel/gyro offset values
	
	Serial.println("Updating internal sensor offsets...");
	//reading current sensor's offset
	Serial.print("\n");
	accelgyro.setXGyroOffset(55);
	accelgyro.setYGyroOffset(-28);
	accelgyro.setZGyroOffset(-2);
	accelgyro.setXAccelOffset(-2581);
	accelgyro.setYAccelOffset(-3937);
	accelgyro.setZAccelOffset(1199);
}


void Init_Wifi()
{
	// Initialize Wifi_connection
	WiFiMulti.addAP("Connectify-me", "hazeduh5");
	Serial.println();
	Serial.println();
	Serial.print("Wait for WiFi... ");
	while(WiFiMulti.run() != WL_CONNECTED) {
	Serial.print(".");
	delay(500);
	}
	Serial.println("");
	Serial.println("WiFi connected");
	Serial.println("IP address: ");
	Serial.println(WiFi.localIP());
	delay(500);
}

void sendData()
{
	const uint16_t port = 8000;
	const char * host = "192.168.85.1"; // ip or dns
	
	// Use WiFiClient class to create TCP connections
	WiFiClient client;
	
	if (!client.connect(host, port)) {
	Serial.println("connection failed");
	client.stop();
	return;
	}
	client.print(normAcc);
	//	    client.print(" , ");
	//        client.println(normGyro);
	//Serial.println("closing connection");
	client.stop();
}

void setup(){
	Serial.begin(115200);
	Wire.begin();
	init_IMU();
	delay(10);
	Init_Wifi();
}
void loop() {
	accelgyro.getMotion6(&ax, &ay, &az, &gx, &gy, &gz);
	rotX = ax / 16384.0;
	rotY = ay / 16384.0;
	rotZ = az /16384.0;
	normAcc = sqrt(rotX*rotX + rotY*rotY + rotZ*rotZ);
	gyroX = gx /131;
	gyroY = gy /131;
	gyroZ = gz /131;
	normGyro = sqrt(gyroX*gyroX + gyroY*gyroY + gyroZ*gyroZ);
	Print_IMU();
	sendData();
}
\end{verbatim}%

\chapter{Python Code for Data Acquisition Program}
\begin{verbatim}
import matplotlib.pyplot as plt
import matplotlib.animation as animation
from drawnow import *
import socketserver

accel = []
gyro = []
plt.ion() #tell the matplotlib that we want to draw live data
def makeFig():
plt.subplot(2,1,1)
plt.plot(accel, 'r', label= 'Normalized Acceleration')
plt.legend(loc='upper left')
plt.ylim(0,5)
plt.subplot(2,1,2)
plt.plot(gyro, 'b', label = 'Normalized Angular Velocity')
plt.legend(loc='upper left')
plt.savefig('testplot.png')

class myTCPServer(socketserver.StreamRequestHandler):
def handle(self):
data = self.rfile.readline()
dataArray = data.decode().split(',')
normAcc = float(dataArray[0])
normGyro = float(dataArray[1])
accel.append(normAcc)
gyro.append(normGyro)
if len(accel) > 100:
accel.pop(0)
if len(gyro) > 100:
gyro.pop(0)
drawnow(makeFig)
#create TCP server
serv = socketserver.TCPServer(("",8000),myTCPServer)
serv.serve_forever()
\end{verbatim}%
%----------------------------------------------------------------------
% END MATERIAL
%----------------------------------------------------------------------

% B I B L I O G R A P H Y
% -----------------------

% The following statement selects the style to use for references.  It controls the sort order of the entries in the bibliography and also the formatting for the in-text labels.

% This specifies the location of the file containing the bibliographic information.  
% It assumes you're using BibTeX (if not, why not?).
\cleardoublepage % This is needed if the book class is used, to place the anchor in the correct page,
                 % because the bibliography will start on its own page.
                 % Use \clearpage instead if the document class uses the "oneside" argument
\phantomsection  % With hyperref package, enables hyperlinking from the table of contents to bibliography             
% The following statement causes the title "References" to be used for the bibliography section:
\renewcommand*{\bibname}{References}

% Add the References to the Table of Contents
\addcontentsline{toc}{chapter}{\textbf{References}}
\bibliographystyle{IEEEtran}
\bibliography{uw-ethesis}
% Tip 5: You can create multiple .bib files to organize your references. 
% Just list them all in the \bibliogaphy command, separated by commas (no spaces).

% The following statement causes the specified references to be added to the bibliography% even if they were not 
% cited in the text. The asterisk is a wildcard that causes all entries in the bibliographic database to be included (optional).


\end{document}
